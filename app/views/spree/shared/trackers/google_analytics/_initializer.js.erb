<% if tracker = Spree::Tracker.current(:google_analytics) %>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=<%= tracker.analytics_id %>"></script>
  <script>
    window.addEventListener('turbolinks:load', function() {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      <% if user_id = try_spree_current_user.try(:id) %>
        gtag('config', '<%= tracker.analytics_id %>', {
          'user_id': '<%= user_id %>'
        });
      <% else %>
        gtag('config', '<%= tracker.analytics_id %>');
      <% end %>
    })
  </script>
<% end %>
